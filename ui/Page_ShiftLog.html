<script type="text/babel">
  const PageShiftLog = ({ user, onBack }) => {
    const [master, setMaster] = useState({ stores: [], layouts: {}, leaders: [], shifts: [] });
    const [loading, setLoading] = useState(false);
    const [msg, setMsg] = useState({ text: '', type: '' });
    const [form, setForm] = useState({
      storeId: user.storeCode || '', lead: '', startH: '', startM: '00',
      endH: '22', endM: '00', layout: '', subPos: '', checks: {}, rating: '',
      selectedReasons: [], isCommitted: false
    });

    useEffect(() => {
      google.script.run.withSuccessHandler(data => setMaster(data)).getMasterData();
    }, []);

    const handleSubmit = () => {
      if (!form.isCommitted) { setMsg({ text: "Vui lòng xác nhận cam kết!", type: "error" }); return; }
      setLoading(true);
      google.script.run
        .withSuccessHandler(() => { setLoading(false); onBack(); })
        .submitShiftLog({ ...form, staffId: user.id, staffName: user.name });
    };

    return (
      <div className="pb-24 fade-in px-4">
        <Notification message={msg.text} type={msg.type} onClose={() => setMsg({text:'', type:''})} />
        <div className="bg-white p-6 rounded-b-[2.5rem] shadow-sm mb-6 text-center">
          <button onClick={onBack} className="absolute left-6 text-gray-400"><i data-lucide="chevron-left"></i></button>
          <h2 className="text-xl font-black text-gray-900">NHẬT KÝ CA TRỰC</h2>
        </div>
        
        <div className="space-y-4">
          <label className="text-[10px] font-extrabold text-gray-400 uppercase">Chọn Nhà hàng</label>
          <select className="input-base" value={form.storeId} onChange={e => setForm({...form, storeId: e.target.value})}>
            <option value="">-- CHỌN --</option>
            {master.stores?.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
          </select>
          
          {/* Form nội dung tiếp theo tương tự code cũ của anh */}
          <button onClick={handleSubmit} disabled={loading} className="w-full py-5 rounded-[2rem] bg-blue-600 text-white font-black">
            {loading ? "ĐANG GỬI..." : "XÁC NHẬN GỬI"}
          </button>
        </div>
      </div>
    );
  };
</script>